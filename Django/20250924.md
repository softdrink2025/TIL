### ORM
- Object Relational Mapping
- 객체 지향 프로그래밍 언어의 객체(Objcet)와 데이터베이스의 데이터를 매핑(Mapping)하는 기술

- ORM은 Django와 데이터베이스 사이에서 언어 번역자 역할을 수행
- 'QuerySet API'라는 특별한 도구를 제공

### QuerySet API
- 데이터베이스의 복잡한 SQL 쿼리문울, 직관적인 Python 코드로 다룰 수 있게 해주는 강력한 번역기
- 동작 방식
    1. Django -> DB: Django(QuerySet API)에서 ORM을 통해 데이터베이스로 정보를 요청할 때
        - SQL 쿼리로 번환되어 데이터베이스로 전달됨

    2. DB -> Django: 데이터베이스가 요청에 대한 응답을 보낼때
        - QuerySet 또는 Instance 형태로 변환하여 Django로 반환

### QuerySet API 구문 기본 구조
- Article (모델 클래스)
    - 역할: 데이터베이스 테이블에 대한 python 클래스 표현
    - articles_article 테이블의 스키마를 정의하며, Django ORM이 데이터베이스와 상호작용할 때 사용하느 기본적인 구조체

- .objects (매니저, manager)
    - 역할: 데이터베이스 조회 작업을 위한 기본 인터페이스
    - 모델 클래스가 데이터베이스 쿼리 작업을 수행할 수 있도록 하는 진입점
    - Django는 모든 모델에 objects라는 이름의 매니저를 자동으로 추가하며, 이 매니저를 통해 .all(), .filter() 등의 쿼리 메서드를 호출

- .all() (QuerySet API 메서드)
    - 역할: 특정 데이터베이스 작업을 수행하는 명령
    - 매니저를 통해 호출되는 메서드로, 해당 모델과 연결된 테이블의 모든 레코드(rows)를 조회하라는 SQL 쿼리를 생성하고 실행

### Query란?
- 데이터베이스에 특정한 데이터를 보여 달라는 요청
- "쿼리문을 작성한다"
    - 원하는 데이터를 얻기 위해 데이터베이스에 요청을 보낼 코드를 작성한다

### QuerySet란?
- 데이터베이스에서 전달받은 객체 목록(데이터 모음)
- 순회 가능한 데이터로 1개 이상 데이터를 불러와 사용 가능함
- Django ORM을 통해 만들어진 자료형
- 단, 데이터베이스가 단일 객체를 반환할 때는 QuerySet이 아닌 모델(Class)의 인스턴스로 반환됨

### CRUD
- 대부분의 소프트웨어가 가지는 기본적인 데이터 처리 기능인 생성, 조회, 수정, 삭제를 묶어 이르는 말
- Create, Read, Update, Delete

### Django shell
- $ python manage.py shell
- Shell "-v" 옵션
    - $ python manage.py shell -v2

### Create
- 데이터 객체를 만드는(생성하는) 3가지 방법
1. 빈 객체 생성 후 할당 및 저장
2. 초기 값과 함께 객체 생성 및 저장
3. create() 메서드로 한 번에 생성 및 저장

- 첫번째 방법: 빈 객체 생성 후 값 할당 및 저장
```shell
>>> article = Article()
>>> article
<Article: Article object (None)>

>>> article.title = 'first'
>>> article.content = 'django!'
>>> article
<Article: Article object (1)>

# save를 하지 않으면 아직 DB에 값이 저장되지 않음
>>> article.save()
>>> article
<Article: Article object (1)>
```

- 두 번째 방법: 초기 값과 함께 객체 생성 및 저장
```shell
>>> article = Article(title='second', content='django!')
>>> article.save()
```
- 첫 번째 방법, 두 번째 방법 모두 결국 save 메서드를 호출해야 DB에 데이터가 저장됨
    - save(): 객체를 데이터베이스에 저장하는 인스턴스 메서드
- 테이블에 한 행(레코드)이 쓰여진 것

- 세번째 방법: create() 메서드로 한 번에 생성 및 저장
    - 저장 이후 바로 생선된 데이터기 반환된다

```shell
>>> Article.objects.create(title='third', content='django!')
```

### Read
- 대표적인 조회 메서드
- QuerySet 반환 메서드
    - all(): 전체 데이터 조회
    - filter(): 주어진 매개변수와 일치하는 객체를 포함하는 QuerySet 반환
    - 데이터가 없으면 빈 쿼리셋을 반환. 에러가 나지 않는다.

- Queryset을 반환하지 않는 메서드
    - get(): 주어진 매개변수와 일치하는 객체를 반환
    - 객체를 찾을 수 없으면 DoesNotExist 예외를 발생시키고,
    둘 이상의 객체를 찾으면 MultipleObjectReturned 예외를 발생시킴
    - 위와 같은 특징을 가지고 있기 때문에 primary key와 같이 고유성(uniqueness)을 보장하는 조회에서 사용해야 함
```shell
>>> Article.objects.get(pk=1)
```

### Update
- 수정을 하려면 데이터를 먼저 조회해야 한다.
- 인스턴스 변수를 변경 후 save 메서드 호출
```shell
# 수정할 인스턴스 조회
>>> article = Article.objects.get(pk=1)
# 인스턴스 변수를 변경
>>> article.title = 'byebye'
# 저장
>>> article.save()
```

### Delete
- 삭제하려는 데이터 조회 후 delete 메서드 호출
```shell
# 삭제할 인스턴스 조회
>>> article = Article.objects.get(pk=1)
# delete 메서도 호출(삭제 된 객체가 반환)
>>> article.delete()
((1, {'articles.Article': 1}))
# 삭제한 데이터는 더 이상 조회할 수 없음
>>> Article.objects.get(pk=1)
DoesNotExist: Article matching query does not exist.
```

### 전체 게시글 조회
- ORM with view
- View 함수에서 QuerySet API 활용하기
    - View에서의 QuerySet API:
        - 웹 페이지에 보여줄 데이터를 DB에서 가져올 때 사용함
        - 사용자가 입력한 새로운 데이터를 DB에 저장할 때 사용함

### Field lookups
- 단순 동치 비교(=)를 넘어 더 상세한 조건으로 조회할 수 있도록 Django ORM이 제공하는 기능
- 특정 단어가 포함된 제목, 특정 날짜 이후에 작성된 글 등을 찾을 수 있게 해줌
- Article.objects.filter(title__startswith='second')
- 모델의 필드 이름 뒤에 이중 밑줄(double underscore, __)을 붙이고 ,원하는 조회 유형을 명시하는 방식으로 사용
- filter(), exclude() 및 get()에 대한 키워드 인자로 지정, 손쉽게 필터링 로직을 구성
